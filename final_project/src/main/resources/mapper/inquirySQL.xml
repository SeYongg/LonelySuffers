<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="i">


<!-- 하나의 상품에 대한 문의글들 조회 -->
<!-- productCategory와 productNo를 조건으로 Row들을 SELECT  -->
	<select id="selectInquiriesByProduct" parameterType="kr.co.inquiry.model.vo.InquiryListing" resultType="i">
		SELECT * FROM (SELECT ROWNUM AS RN, N. * FROM (
			SELECT
			INQUIRY_NO as inquiryNo,
			NVL(ANSWERED, 0) as answered,
			INQUIRER as inquirer,
			INQUIRY_TITLE as inquiryTitle,
			REG_DATE as regDate,
			PRIVATELY as privately
			FROM INQUIRY LEFT JOIN (SELECT INQUIRY_NO, COUNT(*) AS ANSWERED FROM ANSWER GROUP BY INQUIRY_NO) USING (INQUIRY_NO)
			WHERE (PRODUCT_CATEGORY = #{productCategory}) AND (PRODUCT_NO = #{productNo})
			<if test='range > 0'>AND (INQUIRER = #{loggedId})</if>
			ORDER BY INQUIRY_NO DESC
		)N) WHERE RN BETWEEN #{pagingStart} AND #{pagingEnd}
	</select>


<!-- 하나의 상품에 대한 문의글들의 개수  -->
	<select id="totalNumberOfInquiriesByProduct" parameterType="kr.co.inquiry.model.vo.InquiryListing" resultType="_int">
		SELECT COUNT(*) FROM INQUIRY WHERE (PRODUCT_CATEGORY = #{productCategory}) AND (PRODUCT_NO = #{productNo})
		<if test='range > 0'>AND (INQUIRER = #{loggedId})</if>
	</select>


<!-- 문의 상세 보기 inquiryView.do -->
	<select id="selectOneInquiry" parameterType="_int" resultType="i">
		SELECT
		INQUIRY_NO as inquiryNo,
		INQUIRER as inquirer,
		INQUIRY_CONTENT as inquiryContent,
		PRIVATELY as privately
		FROM INQUIRY WHERE INQUIRY_NO = ${_parameter}
	</select>


<!-- 문의에 대한 답변들 출력 -->
	<select id="selectAllAnswer" parameterType="_int" resultType="ia">
		SELECT
		ANSWER_NO as answerNo,
		INQUIRY_NO as inquiryNo,
		ANSWER_CONTENT as answerContent,
		ANSWER_WRITER as answerWriter
		FROM ANSWER WHERE INQUIRY_NO = ${_parameter} ORDER BY ANSWER_NO DESC
	</select>
</mapper>
