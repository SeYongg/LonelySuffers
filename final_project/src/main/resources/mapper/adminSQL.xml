<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="admin">
	<select id="selectAllMember" resultType="m">
		select
			member_name as memberName,
			member_id as memberId,
			member_gender as memberGender,
			member_phone as memberPhone,
			member_email as memberEmail,
			member_grade as memberGrade,
			enroll_date as enrollDate
		from member_tbl
		where member_grade != 4
		order by member_no desc
	</select>
	
	<select id="selectMemberCount" resultType="_int">
		select 
			count(*)
		from member_tbl
		where member_grade != 4
	</select>
	
	<update id="updateMemberGrade" parameterType="m">
		update member_tbl set
			member_grade=#{memberGrade}
		where member_id=#{memberId}
	</update>
	
	<update id="deleteMember" parameterType="string">
		update member_tbl set
			member_grade=4
		where member_id=#{memberId}
	</update>
	
	<select id="selectSearchMember" parameterType="string" resultType="m">
		select
			member_name as memberName,
			member_id as memberId,
			member_gender as memberGender,
			member_phone as memberPhone,
			member_email as memberEmail,
			member_grade as memberGrade,
			enroll_date as enrollDate
		from member_tbl
		where member_id like '%'||#{searchMemberId}||'%'
	</select>
	
	<select id="selectAllSellerApplication" resultType="m">
		select
			member_no as memberNo,
			member_name as memberName,
			member_id as memberId,
			member_gender as memberGender,
			member_phone as memberPhone,
			member_email as memberEmail,
			member_grade as memberGrade,
			enroll_date as enrollDate,
			application_date as applicationDate
		from member_tbl
		join seller_application_tbl using(member_no)
		where member_grade != 4
		order by application_date desc
	</select>
	
	<select id="selectSellerAppCount" resultType="_int">
		select count(*)
		from seller_application_tbl
		join member_tbl using(member_no)
		where member_grade != 4
	</select>
	
	<select id="selectOneSellerApplication" parameterType="string" resultType="m">
		select
			member_no as memberNo,
			member_name as memberName,
			member_id as memberId,
			member_gender as memberGender,
			member_phone as memberPhone,
			member_email as memberEmail,
			member_grade as memberGrade,
			enroll_date as enrollDate,
			application_date as applicationDate
		from member_tbl
		join seller_application_tbl using(member_no)
		where member_id=#{searchMemberId}
		order by application_date desc
	</select>
	
	<update id="updateMemberGradeSeller" parameterType="string">
		update member_tbl set
			member_grade=2
		where member_id=#{memberId}
	</update>
	
	<delete id="deleteSellerApplication" parameterType="_int">
		delete 
		from seller_application_tbl
		where member_no=#{memberNo}
	</delete>
	
	<select id="selectSearchLesson" parameterType="s" resultType="l">
		select
			*
		from lesson
		<choose>
			<when test="searchType.equals('n')">
				where lesson_title like '%'||#{searchKeyword}||'%'
			</when>
			<when test="searchType.equals('s')">
				where writer like '%'||#{searchKeyword}||'%'
			</when>
			<when test="searchType.equals('le')">
				where lesson_name_level like '%'||#{searchKeyword}||'%'
			</when>
			<when test="searchType.equals('lo')">
				where lesson_city like '%'||#{searchKeyword}||'%'
			</when>
		</choose>
	</select>
	
	<select id="selectSearchHouse" parameterType="s" resultType="h">
		select
			*
		from house
		<choose>
			<when test="searchType.equals('n')">
				where house_title like '%'||#{searchKeyword}||'%'
			</when>
			<when test="searchType.equals('s')">
				where writer like '%'||#{searchKeyword}||'%'
			</when>
			<when test="searchType.equals('hn')">
				where room_title like '%'||#{searchKeyword}||'%'
			</when>
			<when test="searchType.equals('lo')">
				where house_address like '%'||#{searchKeyword}||'%'
			</when>
		</choose>
	</select>
	
	<select id="selectAllLesson" resultType="l">
		select
			lesson_no as lessonNo,
			lesson_name_level as lessonNameLevel,
			lesson_title as lessonTitle,
			lesson_price as lessonPrice,
			lesson_max_no as lessonMaxNo,
			writer,
			lesson_city as lessonCity,
			lesson_status as lessonStatus
		from lesson
		where lesson_status=1 or lesson_status=0
	</select>
	
	<select id="selectAllHouse" resultType="h">
		select
			house_no as houseNo,
			house_title as houseTitle,
			writer,
			room_title as roomTitle,
			house_price as housePrice,
			room_capa as roomCapa,
			house_city as houseCity,
			house_status as houseStatus
		from house
		where house_status=1 or house_status=0
	</select>
	
	<select id="selectLessonCount" resultType="_int">
		select
			count(*)
		from lesson
		where lesson_status=1 or lesson_status=0
	</select>
	
	<select id="selectHouseCount" resultType="_int">
		select
			count(*)
		from house
		where house_status=1 or house_status=0
	</select>
	
	<update id="updateLessonStatus" parameterType="l">
		update lesson set
			lesson_status=#{lessonStatus}
		where lesson_no=#{lessonNo}
	</update>
	
	<update id="updateHouseStatus" parameterType="h">
		update house set
			house_status=#{houseStatus}
		where house_no=#{houseNo}
	</update>
	
	<select id="selectNewLesson" resultType="l">
		select 
			lesson_no as lessonNo,
			lesson_name_level as lessonNameLevel,
			lesson_title as lessonTitle,
			lesson_price as lessonPrice,
			lesson_max_no as lessonMaxNo,
			writer,
			lesson_city as lessonCity,
			lesson_status as lessonStatus
		from lesson
		where lesson_status=-1
	</select>
	
	<select id="selectNewHouse" resultType="h">
		select 
			house_no as houseNo,
			house_title as houseTitle,
			writer,
			room_title as roomTitle,
			house_price as housePrice,
			room_capa as roomCapa,
			house_city as houseCity,
			house_status as houseStatus
		from house
		where house_status=-1
	</select>
	
	<select id="selectNewLessonCount" resultType="_int">
		select count(*)
		from lesson
		where lesson_status=-1
	</select>
	
	<select id="selectNewHouseCount" resultType="_int">
		select count(*)
		from house
		where house_status=-1
	</select>
	
	<update id="updateLessonStopSelling" parameterType="_int">
		update lesson set
			lesson_status=0
		where lesson_no=#{_parameter}
	</update>
	
	<update id="updateHouseStopSelling" parameterType="_int">
		update house set
			house_status=0
		where house_no=#{_parameter}
	</update>
	
	<update id="updateApproveLesson" parameterType="_int">
		update lesson set
			lesson_status=1
		where lesson_no=#{_parameter}
	</update>
	
	<update id="updateApproveHouse" parameterType="_int">
		update house set
			house_status=1
		where house_no=#{_parameter}
	</update>
	
	<select id="selectAllOrder" resultType="order">
		select 
			order_no as orderNo,
			member_no as memberNo,
			order_all_price as orderAllPrice,
			decode(order_status, 1, '결제완료', 0, '결제취소') as orderStatusString,
			order_date as orderDate,
			decode(order_product, 1, '강습', 2, '숙박', 3, '강습+숙박') as orderProductString,
			member_id as memberId
		from order_tbl
		join member_tbl using(member_no)
		order by order_no desc
	</select>
	
	<select id="selectOrderCount" resultType="_int">
		select
			count(*)
		from order_tbl
	</select>
	
	<delete id="deleteOrder" parameterType="_int">
		delete
		from order_tbl
		where order_no=#{_parameter}
	</delete>
	
	<select id="selectOrderDetailInfo" parameterType="_int" resultType="order">
		select
			order_no as orderNo;
			member_id as memberId,
			order_all_price as orderAllPrice,
			order_date as orderDate
		from order_tbl
		join member_tbl using(member_no)
		where order_no=#{_parameter}
	</select>
	
	<select id="selectOrderDetail" parameterType="_int" resultType="od">
		select 
		    order_no as orderNo, 
		    order_date as orderDate, 
		    order_status as orderStatus,
		    member_id as memberId, 
		    lesson_name_level as lessonNameLevel, 
		    lesson_title as lessonTitle, 
		    lesson_city as lessonCity, 
		    lesson_start_time as lessonStartTime, 
		    lesson_end_time as lessonEndTime,
		    lesson_teacher as lessonTeacher,
		    house_title as houseTitle,
		    house_city as houseCity,
		    h.writer as houseWriter,
		    room_title as roomTitle,
		    house_barbecue as houseBarbecue,
		    house_party as houseParty,
		    book_start_date as bookStartDate,
		    book_end_date as bookEndDate,
		    product_price as productPrice
		from order_detail od
		left join order_tbl o using(order_no)
		left join member_tbl m using(member_no)
		left join lesson l using(lesson_no)
		left join house h using(house_no)
		left join room_book rb using(room_book_no)
		where order_no=#{_parameter}
	</select>
	
	<select id="selectOrderDetailCount" parameterType="_int" resultType="_int">
		select
			count(*)
		from order_detail
		where order_no=#{_parameter}
	</select>

 	<select id="selectLessonWishList" parameterType="string" resultType="w">
 		select
 			wish_no as wishNo,
 			member_id as memberId,
 			lesson_no as lessonNo,
 			lesson_name_level as lessonNameLevel,
 			lesson_title as lessonTitle,
 			lesson_price as lessonPrice,
 			lesson_max_no as lessonMaxNo,
 			lesson_start_time as lessonStartTime,
 			lesson_end_time as lessonEndTime,
 			lesson_city as lessonCity,
 			lesson_info_pic as lessonInfoPic
 		from wishList
 		join lesson using(lesson_no)
 		where member_id=#{_parameter} and house_no is null
 		order by wish_no desc
 	</select>
 	
 	<select id="selectHouseWishList" parameterType="string" resultType="w">
 		select
 			w.wish_no as wishNo,
 			w.member_id as memberId,
 			w.house_no as houseNo,
 			h.house_title as houseTitle,
 			h.room_title as roomTitle,
 			h.house_city as houseCity,
 			h.house_photo1 as housePhoto1,
 			h.room_capa as roomCapa,
 			h.house_price as housePrice,
 			h.house_description as houseDescription
 		from wishList w
 		join house h on(h.house_no=w.house_no)
 		where member_id=#{_parameter} and lesson_no is null
 		order by wish_no desc
 	</select>
 	
 	<select id="selectAllWishList" parameterType="string" resultType="w">
		select
 			w.wish_no as wishNo,
 			w.member_id as memberId,
 			w.lesson_no as lessonNo,
 			l.lesson_name_level as lessonNameLevel,
 			l.lesson_title as lessonTitle,
 			l.lesson_price as lessonPrice,
 			l.lesson_max_no as lessonMaxNo,
 			l.lesson_start_time as lessonStartTime,
 			l.lesson_end_time as lessonEndTime,
 			l.lesson_city as lessonCity,
 			l.lesson_info_pic as lessonInfoPic,
 			w.house_no as houseNo,
 			h.house_title as houseTitle,
 			h.room_title as roomTitle,
 			h.house_city as houseCity,
 			h.house_photo1 as housePhoto1,
 			h.room_capa as roomCapa,
 			h.house_price as housePrice,
 			h.house_description as houseDescription
 		from wishList w
 		left join lesson l on(l.lesson_no=w.lesson_no)
 		left join house h on(h.house_no=w.house_no)
 		where member_id=#{_parameter}
 		order by wish_no desc
 	</select>
 
</mapper>
