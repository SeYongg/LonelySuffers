<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="l">

<!-- 강습 상품 상세페이지 보기 lessonView.do -->
	<select id="selectOneLesson" parameterType="_int" resultMap="getLesson">
		SELECT * FROM LESSON WHERE LESSON_NO = ${_parameter}
	</select>


<!-- 강습 상품 신규 등록 -->
	<insert id="insertLesson" parameterType="l">
		INSERT INTO LESSON VALUES (LESSON_SEQ.NEXTVAL, #{lessonLevel}, #{lessonTitle}, #{lessonPrice}, #{lessonInfo}, #{lessonInfoPic}, #{lessonTeacher}, #{lessonMaxNo}, #{lessonStartTime}, #{lessonEndTime}, -1, '', #{writer}, #{lessonCity}, '')
		<selectKey resultType="_int" order="AFTER" keyProperty="lessonNo">
			SELECT MAX(LESSON_NO) FROM LESSON
		</selectKey>
	</insert>


<!-- 상품 등록 후 강습 상품 사진 업로드 -->
	<update id="uploadLessonPhoto" parameterType="l">
		UPDATE LESSON SET
		LESSON_INFO_PIC = #{lessonInfoPic}
  		WHERE LESSON_NO = #{lessonNo}
	</update>


<!-- 강습 상품 수정 -->
	<update id="updateLesson" parameterType="l">
		UPDATE LESSON SET
		<if test='lessonLevel != 0'>LESSON_LEVEL = #{lessonLevel},</if>
		<if test='lessonTitle != null'>LESSON_TITLE = #{lessonTitle},</if>
		<if test='lessonCity != null'>LESSON_CITY = #{lessonCity},</if>
		<if test='lessonInfo != null'>LESSON_INFO = #{lessonInfo},</if>
		<if test='lessonTeacher != null'>LESSON_TEACHER = #{lessonTeacher},</if>
		<if test='lessonMaxNo != 0'>LESSON_MAX_NO = #{lessonMaxNo},</if>
		<if test='lessonStartTime != null'>LESSON_START_TIME = #{lessonStartTime},</if>
		<if test='lessonEndTime != null'>LESSON_END_TIME = #{lessonEndTime},</if>
		LESSON_PRICE = #{lessonPrice}
  		WHERE LESSON_NO = #{lessonNo}
	</update>


<!-- 조건에 맞는 레슨리스트 불러오기 -->
	<select id="selectLessonList" parameterType="l" resultMap="getLesson">
		SELECT LESSON_NO, LESSON_TITLE, LESSON_INFO_PIC, LESSON_LEVEL, LESSON_MAX_NO, LESSON_START_TIME, LESSON_END_TIME, LESSON_PRICE 
		FROM LESSON WHERE LESSON_MAX_NO>=#{lessonMaxNo} AND LESSON_CITY = #{lessonCity} AND LESSON_STATUS = 1
		
		<if test='level1 == 1'>AND LESSON_LEVEL = 1</if>

		<choose>
			<when test='level1 == 1 and level2 == 1'>OR LESSON_LEVEL = 2</when>
			<when test='level1 != 1 and level2 == 1'>AND LESSON_LEVEL = 2</when>
		</choose>
		
		<choose>
			<when test='level1 == 1 and level2 == 1 and level3 == 1'>OR LESSON_LEVEL = 3</when>
			<when test='level1 != 1 and level2 == 1 and level3 == 1'>OR LESSON_LEVEL = 3</when>
			<when test='level1 == 1 and level2 != 1 and level3 == 1'>OR LESSON_LEVEL = 3</when>
			<when test='level1 != 1 and level2 != 1 and level3 == 1'>AND LESSON_LEVEL = 3</when>
		</choose>
		
	</select>


<!-- 강습 상품 Lesson 의 모든 column에 대한 resultMap -->
	<resultMap type="l" id="getLesson">
		<result column="LESSON_NO" property="lessonNo"></result>
		<result column="LESSON_LEVEL" property="lessonLevel"></result>
		<result column="LESSON_TITLE" property="lessonTitle"></result>
		<result column="LESSON_CITY" property="lessonCity"></result>
		<result column="LESSON_PRICE" property="lessonPrice"></result>
		<result column="LESSON_INFO" property="lessonInfo"></result>
		<result column="LESSON_INFO_PIC" property="lessonInfoPic"></result>
		<result column="LESSON_TEACHER" property="lessonTeacher"></result>
		<result column="LESSON_MAX_NO" property="lessonMaxNo"></result>
		<result column="LESSON_START_TIME" property="lessonStartTime"></result>
		<result column="LESSON_END_TIME" property="lessonEndTime"></result>
		<result column="LESSON_STATUS" property="lessonStatus"></result>
		<result column="LESSON_SCORE" property="lessonScore"></result>
		<result column="WRITER" property="writer"></result>
		<result column="REJECT_COMMNET" property="rejectComment"></result>
	</resultMap>


</mapper>
