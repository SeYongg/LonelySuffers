<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="carpoolFilter">

<!-- 필터링으로 카풀 검색결과 조회하기 -->
	<select id="filterCapool" parameterType="c" resultType="c">
	select 
 		carpool_no as carpoolNo,
 		departure_date as departureDate,
 		departure_time as departureTime,
 		reg_date as regDate,
 		oneway_round as onewayRound,
 		departure_region as departureRegion,
 		departure_district as departureDistrict,
 		arrival_region as arrivalRegion,
 		arrival_district as arrivalDistrict,
 		capacity as capacity,
 		surfboard_room as surfboardRoom,
 		driver_msg as driverMsg,
 		NVL(GET_PASSENGER, 0) AS RESERVED
 	FROM CARPOOL
 		LEFT JOIN (SELECT CARPOOL_NO, COUNT(CARPOOL_NO) AS GET_PASSENGER FROM CARPOOL RIGHT JOIN PASSENGER USING (CARPOOL_NO) 
 		WHERE departure_region=#{departureRegion} and departure_date=#{departureDate} and departure_time=#{departureTime}
 		and  arrival_region=#{arrivalRegion} and closure=1 and oneway_round=#{oneway_round}
 		GROUP BY CARPOOL_NO)
 		USING (CARPOOL_NO)
	
	</select>
	




</mapper>